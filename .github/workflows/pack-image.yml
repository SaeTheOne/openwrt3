# .github/workflows/pack-image.yml
on:
  workflow_call:

jobs:
  pack:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout packit tool
        run: git clone --depth=1 https://github.com/unifreq/openwrt_packit.git

      - name: Download rootfs artifact
        uses: actions/download-artifact@v4
        with:
          name: openwrt-rootfs-for-packing
        # 文件会出现在当前目录：./rootfs.tar.gz

      - name: Pack image
        working-directory: openwrt_packit
        run: |
          ROOTFS="../rootfs.tar.gz"
          if [ ! -f "$ROOTFS" ]; then
            echo "❌ Missing rootfs!"
            exit 1
          fi
          # 执行你的打包命令，例如：
          # ./make_ext4fs -l 1024M -r ../rootfs.tar.gz output.img
